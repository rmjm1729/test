
# --- CSV DATA ---
csv_data = """Player,Span,Mat,Inns,Balls,Overs,Mdns,Runs,Wkts,BBI,Ave,Econ,SR,4,5,10
M Muralidaran (ICC/SL),1992-2010,133,230,44039,7339.5,1794,18180,800,9/51,22.72,2.47,55.04,45,67,22
SK Warne (AUS),1992-2007,145,273,40705,6784.1,1761,17995,708,8/71,25.41,2.65,57.49,48,37,10
JM Anderson (ENG),2003-2024,188,350,40037,6672.5,1730,18627,704,7/42,26.45,2.79,56.87,32,32,3
A Kumble (IND),1990-2008,132,236,40850,6808.2,1576,18355,619,10/74,29.65,2.69,65.99,31,35,8
SCJ Broad (ENG),2007-2023,167,309,33698,5616.2,1304,16719,604,8/15,27.68,2.97,55.79,28,20,3
GD McGrath (AUS),1993-2007,124,243,29248,4874.4,1470,12186,563,8/24,21.64,2.49,51.95,28,29,3
NM Lyon (AUS),2011-2025,139,259,34502,5750.2,1089,16942,562,8/50,30.14,2.94,61.39,26,24,5
R Ashwin (IND),2011-2024,106,200,27246,4541.0,907,12891,537,7/59,24.00,2.83,50.73,25,37,8
CA Walsh (WI),1984-2001,132,242,30019,5003.1,1144,12688,519,7/37,24.44,2.53,57.84,32,22,3
DW Steyn (SA),2004-2019,93,171,18608,3101.2,660,10077,439,7/51,22.95,3.24,42.38,27,26,5
N Kapil Dev (IND),1978-1994,131,227,27740,4623.2,1060,12867,434,9/83,29.64,2.78,63.91,17,23,2
HMRKB Herath (SL),1999-2018,93,170,25993,4332.1,814,12157,433,9/127,28.07,2.80,60.03,20,34,9
Sir RJ Hadlee (NZ),1973-1990,86,150,21918,-,809,9611,431,9/52,22.29,2.63,50.85,25,36,9
SM Pollock (SA),1995-2008,108,202,24353,4058.5,1222,9733,421,7/87,23.11,2.39,57.84,23,16,1
Harbhajan Singh (IND),1998-2015,103,190,28580,4763.2,871,13537,417,8/84,32.46,2.84,68.53,16,25,5
Wasim Akram (PAK),1985-2002,104,181,22627,3771.1,871,9779,414,7/119,23.62,2.59,54.65,20,25,5
CEL Ambrose (WI),1988-2000,98,179,22103,3683.5,1001,8501,405,8/45,20.99,2.30,54.57,21,22,3
MA Starc (AUS),2011-2025,100,192,19094,3182.2,606,10863,402,6/9,27.02,3.41,47.49,20,16,2
TG Southee (NZ),2008-2024,107,203,23490,3915.0,889,11832,391,7/64,30.26,3.02,60.07,19,15,1
M Ntini (SA),1998-2009,101,190,20834,3472.2,759,11242,390,7/37,28.82,3.23,53.42,19,18,4
IT Botham (ENG),1977-1992,102,168,21815,-,788,10878,383,8/34,28.40,2.99,56.95,17,27,4
MD Marshall (WI),1978-1991,81,151,17584,2930.4,614,7876,376,7/22,20.94,2.68,46.76,19,22,4
Waqar Younis (PAK),1989-2003,87,154,16224,2704.0,516,8788,373,7/76,23.56,3.25,43.49,28,22,5
Imran Khan (PAK),1971-1992,88,142,19458,-,727,8258,362,8/58,22.81,2.54,53.75,17,23,6
DL Vettori (ICC/NZ),1997-2014,113,187,28814,4802.2,1197,12441,362,7/87,34.36,2.59,79.59,19,20,3
DK Lillee (AUS),1971-1984,70,132,18467,-,652,8493,355,7/83,23.92,2.75,52.01,23,23,7
WPUJC Vaas (SL),1994-2009,111,194,23438,3906.2,895,10501,355,7/71,29.58,2.68,66.02,20,12,2
K Rabada (SA),2015-2025,71,130,13100,2183.2,433,7306,336,7/112,21.74,3.34,38.98,15,17,4
AA Donald (SA),1992-2002,72,129,15519,2586.3,661,7344,330,8/71,22.25,2.83,47.02,11,20,3
RA Jadeja (IND),2012-2025,83,156,19067,3177.5,742,8129,326,7/42,24.93,2.55,58.48,13,15,3
RGD Willis (ENG),1971-1984,90,165,17357,-,554,8190,325,8/43,25.20,2.83,53.40,12,16,0
TA Boult (NZ),2011-2022,78,149,17417,2902.5,656,8717,317,6/30,27.49,3.00,54.94,18,10,1
MG Johnson (AUS),2007-2015,73,140,16001,2666.5,514,8891,313,8/61,28.40,3.33,51.12,16,12,3
I Sharma (IND),2007-2021,105,188,19160,3193.2,640,10078,311,7/74,32.40,3.15,61.60,10,11,1
Z Khan (IND),2000-2014,92,165,18785,3130.5,624,10247,311,7/87,32.94,3.27,60.40,15,11,1
B Lee (AUS),1999-2008,76,150,16531,2755.1,547,9554,310,5/30,30.81,3.46,53.32,17,10,0
PJ Cummins (AUS),2011-2025,71,132,14187,2364.3,514,6829,309,6/23,22.10,2.88,45.91,17,14,2
M Morkel (SA),2006-2018,86,160,16498,2749.4,605,8550,309,6/23,27.66,3.10,53.39,18,8,0
LR Gibbs (WI),1958-1976,79,148,27115,-,1313,8989,309,8/38,29.09,1.98,87.75,11,18,2
FS Trueman (ENG),1952-1965,67,127,15178,-,522,6625,307,8/31,21.57,2.61,49.43,19,17,3
DL Underwood (ENG),1966-1982,86,151,21862,-,1239,7674,297,8/51,25.83,2.10,73.60,13,17,6
JR Hazlewood (AUS),2014-2025,76,143,15423,2570.3,657,7144,295,6/67,24.21,2.77,52.28,11,13,0
JH Kallis (ICC/SA),1995-2013,166,272,20232,3372.0,848,9535,292,6/54,32.65,2.82,69.28,7,5,0
CJ McDermott (AUS),1984-1996,71,124,16586,2764.2,579,8332,291,8/97,28.63,3.01,56.99,17,14,2
KAJ Roach (WI),2009-2025,85,154,14944,2490.4,540,7729,284,6/48,27.21,3.10,52.61,14,11,1
BS Bedi (IND),1966-1979,67,118,21364,-,1096,7637,266,7/98,28.71,2.14,80.31,13,14,1
Danish Kaneria (PAK),2000-2010,61,112,17697,2949.3,517,9082,261,7/77,34.79,3.07,67.80,8,15,2
N Wagner (NZ),2012-2024,64,122,13725,2287.3,473,7169,260,7/39,27.57,3.13,52.78,13,9,0
J Garner (WI),1977-1987,58,111,13169,2194.5,576,5433,259,6/56,20.97,2.47,50.84,18,7,0
JN Gillespie (AUS),1996-2006,71,137,14234,2372.2,630,6770,259,7/37,26.13,2.85,54.95,8,8,0
GP Swann (ENG),2008-2013,60,109,15349,2558.1,493,7642,255,6/65,29.96,2.98,60.19,14,17,3
JB Statham (ENG),1951-1965,70,129,16056,-,595,6261,252,7/39,24.84,2.33,63.71,9,9,1
MA Holding (WI),1975-1987,60,113,12680,-,459,5898,249,8/92,23.68,2.79,50.92,11,13,2
R Benaud (AUS),1952-1964,63,116,19108,-,805,6704,248,7/72,27.03,2.10,77.04,16,16,1
MJ Hoggard (ENG),2000-2008,67,122,13909,2318.1,493,7564,248,7/61,30.50,3.26,56.08,13,7,1
GD McKenzie (AUS),1961-1971,60,113,17681,-,547,7328,246,8/71,29.78,2.48,71.87,7,16,3
Shakib Al Hasan (BAN),2007-2024,71,121,15675,2612.3,486,7804,246,7/36,31.72,2.98,63.71,11,19,2
Yasir Shah (PAK),2014-2022,48,89,14255,2375.5,359,7657,244,8/41,31.38,3.22,58.42,15,16,3
BS Chandrasekhar (IND),1964-1979,58,97,15963,-,584,7199,242,8/79,29.74,2.70,65.96,12,16,2
Taijul Islam (BAN),2014-2025,55,98,14585,2430.5,425,7423,237,8/39,31.32,3.05,61.54,12,17,2
AV Bedser (ENG),1946-1955,51,92,15918,-,574,5876,236,7/44,24.89,2.21,67.44,11,15,5
J Srinath (IND),1991-2002,67,121,15104,2517.2,599,7196,236,8/86,30.49,2.85,64.00,8,10,1
Abdul Qadir (PAK),1977-1990,67,111,17126,-,608,7742,236,9/56,32.80,2.71,72.56,12,15,5
GS Sobers (WI),1954-1974,93,159,21599,-,974,7999,235,6/73,34.03,2.22,91.91,8,6,0
AR Caddick (ENG),1993-2003,62,105,13558,2259.4,501,6999,234,7/46,29.91,3.09,57.94,9,13,1
CS Martin (NZ),2000-2013,71,126,14026,2337.4,486,7878,233,6/26,33.81,3.37,60.19,10,10,1
Mohammed Shami (IND),2013-2023,64,122,11515,1919.1,364,6346,229,6/56,27.71,3.30,50.28,12,6,0
D Gough (ENG),1994-2003,58,95,11821,1970.1,369,6503,229,6/42,28.39,3.30,51.62,14,9,0
RR Lindwall (AUS),1946-1960,61,113,13650,-,419,5251,228,7/38,23.03,2.30,59.86,8,12,0
SJ Harmison (ENG/ICC),2002-2009,63,115,13375,2229.1,431,7192,226,7/12,31.82,3.22,59.18,11,8,1
A Flintoff (ENG/ICC),1998-2009,79,137,14951,2491.5,507,7410,226,5/58,32.78,2.97,66.15,11,3,0
VD Philander (SA),2011-2020,64,119,11391,1898.3,507,5000,224,6/21,22.32,2.63,50.85,8,13,2
BA Stokes (ENG),2013-2025,114,168,12950,2158.2,374,7173,224,6/22,32.02,3.32,57.81,9,4,0
PM Siddle (AUS),2008-2019,67,126,13907,2317.5,615,6777,221,6/54,30.66,2.92,62.92,8,8,0
CL Cairns (NZ),1989-2004,62,104,11698,1949.4,414,6410,218,7/27,29.40,3.28,53.66,11,13,1
JJ Bumrah (IND),2018-2025,47,90,9150,1525.0,361,4229,217,6/27,19.48,2.77,42.16,7,15,0
CV Grimmett (AUS),1925-1936,37,67,14513,-,736,5231,216,7/40,24.21,2.16,67.18,7,21,7
HH Streak (ZIM),1993-2005,65,102,13559,2259.5,595,6079,216,6/73,28.14,2.69,62.77,16,7,0
MG Hughes (AUS),1985-1994,53,97,12285,2047.3,499,6017,212,8/87,28.38,2.93,57.94,14,7,1
SCG MacGill (AUS),1998-2008,44,85,11237,1872.5,365,6038,208,8/108,29.02,3.22,54.02,9,12,2
Saqlain Mushtaq (PAK),1995-2004,49,86,14070,2345.0,541,6206,208,8/164,29.83,2.64,67.64,12,13,3
Mehidy Hasan Miraz (BAN),2016-2025,54,94,12696,2116.0,328,6635,205,7/58,32.36,3.13,61.93,9,13,3
MM Ali (ENG),2014-2023,68,119,12610,2101.4,293,7612,204,6/53,37.31,3.62,61.81,13,5,1
KA Maharaj (SA),2016-2025,59,100,11666,1944.2,367,6055,203,9/129,29.82,3.11,57.46,6,11,1
AME Roberts (WI),1974-1983,47,90,11135,-,382,5174,202,7/54,25.61,2.78,55.12,8,11,2
JA Snow (ENG),1965-1976,49,93,12021,-,415,5387,202,7/40,26.66,2.68,59.50,12,8,1
JR Thomson (AUS),1972-1985,51,90,10535,-,301,5601,200,6/46,28.00,3.18,52.67,16,8,0
"""

# --- Imports ---
import pandas as pd
import numpy as np
from sklearn.preprocessing import StandardScaler
from sklearn.cluster import KMeans
from io import StringIO

# Load into DataFrame
data = pd.read_csv(StringIO(csv_data))
data.rename(columns={'5': '5w', '10': '10w'}, inplace=True)

# Replace '-' in all numeric columns with 0
for col in ['Overs', '4', '5w', '10w', 'Mat', 'Inns', 'Balls', 'Mdns', 'Runs', 'Wkts', 'Ave', 'Econ', 'SR']:
    data[col] = data[col].replace('-', 0)

numeric_cols = ['Mat', 'Inns', 'Balls', 'Overs', 'Mdns', 'Runs', 'Wkts', 'Ave', 'Econ', 'SR', '4', '5w', '10w']
for col in numeric_cols:
    data[col] = pd.to_numeric(data[col], errors='coerce')
for col in ['4', '5w', '10w']:
    data[col] = data[col].fillna(0)
essential = ['Mat', 'Wkts', 'Ave', 'Econ', 'SR']
data = data.dropna(subset=essential)

# --- Feature Engineering ---
data['WktsPerMatch'] = data['Wkts'] / data['Mat']

def get_span_years(span):
    try:
        start, end = span.split('-')
        return int(end) - int(start) + 1
    except:
        return np.nan

data['SpanYears'] = data['Span'].apply(get_span_years)

# --- Era Normalization ---
era_bins = [0, 1919, 1929, 1939, 1949, 1959, 1969, 1979, 1989, 1999, 2009, 2019, 2100]
era_labels = [
    'pre1920', '1920s', '1930s', '1940s', '1950s', '1960s', '1970s',
    '1980s', '1990s', '2000s', '2010s', '2020s'
]
era_avg = {
    'pre1920': {'Ave': 25, 'Econ': 2.63},
    '1920s':   {'Ave': 32, 'Econ': 2.63},
    '1930s':   {'Ave': 35, 'Econ': 2.63},
    '1940s':   {'Ave': 32, 'Econ': 2.28},
    '1950s':   {'Ave': 28.5, 'Econ': 2.28},
    '1960s':   {'Ave': 32, 'Econ': 2.49},
    '1970s':   {'Ave': 32, 'Econ': 2.66},
    '1980s':   {'Ave': 32, 'Econ': 2.85},
    '1990s':   {'Ave': 31.5, 'Econ': 2.83},
    '2000s':   {'Ave': 34.1, 'Econ': 3.08},
    '2010s':   {'Ave': 33.85, 'Econ': 3.15},
    '2020s':   {'Ave': 33.85, 'Econ': 3.22},
}

def get_era(span):
    try:
        start, end = span.split('-')
        mid = (int(start) + int(end)) // 2
        for i in range(len(era_bins)-1):
            if era_bins[i] <= mid < era_bins[i+1]:
                return era_labels[i]
        return '2010s'
    except:
        return '2010s'

data['Era'] = data['Span'].apply(get_era)
data['AdjAvg'] = data.apply(lambda x: x['Ave'] / era_avg[x['Era']]['Ave'] if pd.notnull(x['Ave']) else np.nan, axis=1)
data['AdjEcon'] = data.apply(lambda x: x['Econ'] / era_avg[x['Era']]['Econ'] if pd.notnull(x['Econ']) else np.nan, axis=1)

# --- Scoring Parameters ---
parameters = [
    'AdjAvg',        # Adjusted bowling average
    'SR',            # Strike rate
    'AdjEcon',       # Adjusted economy rate
    'WktsPerMatch',  # Wickets per match
    '5w',            # 5-wicket hauls
    '10w',           # 10-wicket hauls
    'SpanYears'      # Career length
]
lower_better = ['AdjAvg', 'SR', 'AdjEcon']
higher_better = ['WktsPerMatch', '5w', '10w', 'SpanYears']

# --- Z-score Normalization ---
scaler = StandardScaler()
for col in parameters:
    data[col] = pd.to_numeric(data[col], errors='coerce')
data = data.dropna(subset=parameters)
data_z = pd.DataFrame(scaler.fit_transform(data[parameters]), columns=parameters)
for col in lower_better:
    data_z[col] = -data_z[col]  # invert so that higher is better for all

# --- Ideal Bowler Definition ---
def top10_mean(col):
    n = max(1, int(0.1 * len(data_z)))
    return data_z[col].sort_values(ascending=False).head(n).mean()
center = np.array([top10_mean(col) for col in data_z.columns])

# --- Euclidean Distance Scoring ---
def euclidean(row):
    return np.linalg.norm(row.values - center)
data['score'] = data_z.apply(euclidean, axis=1)

# --- K-MEANS CLUSTERING OF BOWLERS ---
N = len(data_z)
n_clusters = max(2, int(np.sqrt(N)))
kmeans = KMeans(n_clusters=n_clusters, random_state=42, n_init=10)
data['cluster'] = kmeans.fit_predict(data_z)

# --- Final Ranking (re-sort data after cluster assignment) ---
best_bowlers = data.sort_values('score')

# --- Output ---
print("\nTop 10 bowlers and their cluster assignments:")
print(best_bowlers[['Player', 'score', 'cluster'] + parameters].head(10))

print(f"\nK-means cluster centers (z-score space, columns: {parameters}):")
for i, center in enumerate(kmeans.cluster_centers_):
    print(f"Cluster {i}: {center}")
# --- View bowlers by cluster ---
print("\n--- Bowlers by Cluster ---")
for clus in sorted(data['cluster'].unique()):
    print(f"\nCluster {clus} ({len(data[data['cluster'] == clus])} bowlers):")





# --- ALGORITHM EXPLANATION ---
# This script ranks Test match bowlers using a composite score based on multiple metrics, normalized for era and career length.
#
# 1. Feature Engineering:
#    - Wickets per match: Measures strike power, not just longevity.
#    - Career span (years): Rewards bowlers with long, sustained careers.
#
# 2. Era Normalization:
#    - Bowling average and economy rate are adjusted by dividing by the typical average/economy for the bowler's era (based on career midpoint).
#    - This allows fair comparison between bowlers from different periods, accounting for changes in scoring rates and conditions.
#
# 3. Parameter Selection:
#    - Metrics used: Adjusted bowling average, strike rate, adjusted economy, wickets per match, 5-fors, 10-fors, career span.
#    - Lower is better for average, strike rate, economy; higher is better for the rest.
#
# 4. Normalization:
#    - All metrics are standardized (z-score) so they are on the same scale.
#    - For metrics where lower is better, the z-score is inverted so that higher is always better.
#
# 5. Ideal Bowler Definition:
#    - The 'ideal' bowler is defined as the mean of the top 10% for each metric (i.e., a composite of the best performers on each axis).
#    - This avoids biasing toward outliers and gives a realistic benchmark.
#
# 6. Scoring:
#    - Each bowler's metrics are compared to the ideal using Euclidean distance in the normalized space.
#    - Lower distance means closer to the ideal, i.e., a better all-round record.
#
# 7. Output:
#    - The top 10 bowlers by this composite score are printed, along with their metrics.

# --- Feature Engineering ---
# Calculate wickets per match (strike power)





